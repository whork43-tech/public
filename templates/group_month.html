<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>é€£çµå¸³è™Ÿï½œæœˆæ·¨åˆ©</title>
    <link rel="stylesheet" href="/static/style.css?v=1003">
</head>

<body>
    <div class="container">

        <div class="card topbar">
            <div>
                <h2 style="margin:0;">ğŸ‘¥ é€£çµå¸³è™Ÿï½œæœˆæ·¨åˆ©</h2>
                <div class="muted" style="margin-top:6px;">
                    ç›®å‰æœˆä»½ï¼š<b>{{ show_ym }}</b>
                </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <label class="muted" style="display:flex; gap:8px; align-items:center;">
                    æœˆä»½
                    <input id="ym" type="month" value="{{ show_ym }}"
                        style="padding:9px 12px; border:1px solid #ddd; border-radius:10px;">
                </label>
                <a class="btn" href="/">â† è¿”å›é¦–é </a>
            </div>
        </div>

        {% if not group_enabled %}
        <div class="card danger" style="margin-top:12px;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                <div>
                    <b>âš  é€£çµå¸³è™ŸåŠŸèƒ½æœªé–‹é€š</b>
                    <div class="muted" style="margin-top:6px;">
                        {% if group_mode == 'trial' %}
                        è©¦ç”¨ä¸­ï¼ˆåˆ°æœŸæ—¥ï¼š{{ group_until }}ï¼‰
                        {% else %}
                        {{ group_msg }}
                        {% endif %}
                    </div>
                </div>
                <span class="badge-danger">æœªé–‹é€š</span>
            </div>
        </div>
        {% endif %}

        {# å»ºç«‹ month_net å°ç…§è¡¨ï¼šuser_id -> month_netï¼ˆåªæœ‰é–‹é€šæ‰æœƒæœ‰æ•¸å­—ï¼‰ #}
        {% set net_map = {} %}
        {% if group_enabled and group_summary and group_summary.per_user %}
        {% for u in group_summary.per_user %}
        {% set _ = net_map.update({u.user_id: u.month_net}) %}
        {% endfor %}
        {% endif %}

        {% if linked_accounts and linked_accounts|length > 0 %}

        {% for a in linked_accounts %}
        {% set is_inactive = (not a.main_active) %}
        <div class="card {% if is_inactive %}danger{% endif %}">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
                <div>
                    <div style="font-weight:800; font-size:16px;">
                        {{ a.display_name if a.display_name else a.username }}
                        {% if is_inactive %}
                        <span class="badge-danger" style="margin-left:8px;">æœªé–‹é€š</span>
                        {% else %}
                        <span class="badge-ok" style="margin-left:8px;">å·²é–‹é€š</span>
                        {% endif %}
                    </div>
                    <div class="muted" style="font-size:13px;">
                        å¸³è™Ÿï¼š{{ a.username }}ã€€ï½œã€€IDï¼š{{ a.user_id }}
                    </div>
                </div>

                <div class="pill">
                    ğŸ—“ï¸ æœˆæ·¨åˆ©ï¼š
                    <b>
                        {% if group_enabled %}
                        {{ net_map.get(a.user_id, 0) }}
                        {% else %}
                        â€”
                        {% endif %}
                    </b>
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="card">
            <h2 style="margin:0 0 10px;">ğŸ“Š é€£çµå¸³è™Ÿåˆè¨ˆ</h2>
            <div class="pill" style="display:inline-flex;">
                æœ¬æœˆç¸½æ·¨åˆ©ï¼š
                <b style="margin-left:6px;">
                    {% if group_enabled and group_summary %}
                    {{ group_summary.month_total }}
                    {% else %}
                    â€”
                    {% endif %}
                </b>
            </div>
        </div>

        {% else %}
        <div class="card">
            <p style="margin:0;">ç›®å‰å°šæœªé€£çµä»»ä½•å¸³è™Ÿ</p>
        </div>
        {% endif %}

    </div>

    <script>
        (function () {
            const el = document.getElementById('ym');
            if (!el) return;
            el.addEventListener('change', function () {
                const v = el.value; // YYYY-MM
                if (!v) return;
                window.location.href = '/group-month?ym=' + encodeURIComponent(v);
            });
        })();
    </script>
</body>

</html>